!function(f,m,u,l){var n="ontouchstart"in u,g=function(){var t=u.createElement("div"),e=u.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var s=m.getComputedStyle&&"auto"===m.getComputedStyle(t,"").pointerEvents;return e.removeChild(t),!!s}(),s={contentCallback:function(t){return t.content?t.content:t.id},controlsCallback:function(t){return t.controls?t.controls:""},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",controlsClass:"dd-controls",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(t,e,s){},onDragStart:function(t,e,s){},beforeDragStop:function(t,e,s){},listRenderer:function(t,e){var s="<"+e.listNodeName+' class="'+e.listClass+'" data-group="'+e.group+'">';return s+=t,s+="</"+e.listNodeName+">"},itemRenderer:function(t,e,s,i,o,l){var n=f.map(t,function(t,e){if("data-controls"!==e)return" "+e+'="'+t+'"'}).join(" "),a="<"+o.itemNodeName+n+">";return a+="<"+o.handleNodeName+' class="'+o.handleClass+'">',a+="<"+o.contentNodeName+' class="'+o.contentClass+'">',a+=e,a+="</"+o.contentNodeName+">",a+="</"+o.handleNodeName+">",i&&(a+="<"+o.handleNodeName+' class="'+o.controlsClass+'">',a+=i,a+="</"+o.handleNodeName+">"),a+=s,a+="</"+o.itemNodeName+">"}};function a(t,e){this.w=f(u),this.el=f(t),(e=e||s).rootClass!==l&&"dd"!==e.rootClass&&(e.listClass=e.listClass?e.listClass:e.rootClass+"-list",e.itemClass=e.itemClass?e.itemClass:e.rootClass+"-item",e.dragClass=e.dragClass?e.dragClass:e.rootClass+"-dragel",e.handleClass=e.handleClass?e.handleClass:e.rootClass+"-handle",e.collapsedClass=e.collapsedClass?e.collapsedClass:e.rootClass+"-collapsed",e.placeClass=e.placeClass?e.placeClass:e.rootClass+"-placeholder",e.noDragClass=e.noDragClass?e.noDragClass:e.rootClass+"-nodrag",e.noChildrenClass=e.noChildrenClass?e.noChildrenClass:e.rootClass+"-nochildren",e.emptyClass=e.emptyClass?e.emptyClass:e.rootClass+"-empty"),this.options=f.extend({},s,e),this.options.json!==l&&this._build(),this.init()}a.prototype={init:function(){var o=this;o.reset(),o.el.data("nestable-group",this.options.group),o.placeEl=f('<div class="'+o.options.placeClass+'"/>');var t=this.el.find(o.options.itemNodeName);f.each(t,function(t,e){var s=f(e),i=s.parent();o.setParent(s),i.hasClass(o.options.collapsedClass)&&o.collapseItem(i.parent())}),t.length||this.appendEmptyElement(this.el),o.el.on("click","button",function(t){if(!o.dragEl){var e=f(t.currentTarget),s=e.data("action"),i=e.parents(o.options.itemNodeName).eq(0);"collapse"===s&&o.collapseItem(i),"expand"===s&&o.expandItem(i)}});var e=function(t){var e=f(t.target);if(!e.hasClass(o.options.handleClass)){if(e.closest("."+o.options.noDragClass).length)return;e=e.closest("."+o.options.handleClass)}e.length&&!o.dragEl&&(o.isTouch=/^touch/.test(t.type),o.isTouch&&1!==t.touches.length||(t.preventDefault(),o.dragStart(t.touches?t.touches[0]:t)))},s=function(t){o.dragEl&&(t.preventDefault(),o.dragMove(t.touches?t.touches[0]:t))},i=function(t){o.dragEl&&(t.preventDefault(),o.dragStop(t.touches?t.changedTouches[0]:t))};n&&(o.el[0].addEventListener("touchstart",e,!1),m.addEventListener("touchmove",s,!1),m.addEventListener("touchend",i,!1),m.addEventListener("touchcancel",i,!1)),o.el.on("mousedown",e),o.w.on("mousemove",s),o.w.on("mouseup",i);o.el.on("destroy-nestable",function(){n&&(o.el[0].removeEventListener("touchstart",e,!1),m.removeEventListener("touchmove",s,!1),m.removeEventListener("touchend",i,!1),m.removeEventListener("touchcancel",i,!1)),o.el.off("mousedown",e),o.w.off("mousemove",s),o.w.off("mouseup",i),o.el.off("click"),o.el.off("destroy-nestable"),o.el.data("nestable",null)}),f("ol.dd-dragel").remove()},destroy:function(){this.el.trigger("destroy-nestable")},add:function(t){var e="."+this.options.listClass,s="."+this.options.emptyClass;if(0<f(this.el).children(s).length){var i=f(u.createElement(this.options.listNodeName)).addClass(this.options.listClass);f(this.el).children(s).replaceWith(i)}var o=f(this.el).children(e);t.parent_id!==l&&(o=o.find('[data-id="'+t.parent_id+'"]'),delete t.parent_id,0===o.children(e).length&&(o=o.append(this.options.listRenderer("",this.options))),o=o.find(e+":first"),this.setParent(o.parent())),o.append(this._buildItem(t,this.options))},replace:function(t){var e=this._buildItem(t,this.options);this._getItemById(t.id).replaceWith(e)},removeItem:function(t){var e=this.options,s=this.el;(t=t||this).remove();var i="."+e.listClass+" ."+e.listClass+":not(:has(*))";f(s).find(i).remove();f(s).find('[data-action="expand"], [data-action="collapse"]').each(function(){0===f(this).siblings("."+e.listClass).length&&f(this).remove()})},remove:function(t,e){var s=this.options,i=this,o=this._getItemById(t),l=s.effect.animation||"fade",n=s.effect.time||"slow";"fade"===l?o.fadeOut(n,function(){i.removeItem(o)}):this.removeItem(o),e&&e()},removeAll:function(t){var e=this,s=this.options,i=e.el.find(s.listNodeName).first(),o=i.children(s.itemNodeName),l=s.effect.animation||"fade",n=s.effect.time||"slow";function a(){o.each(function(){e.removeItem(f(this))}),i.replaceWith('<div class="'+s.emptyClass+'"/>'),i.show(),t&&t()}"fade"===l?i.fadeOut(n,a):a()},_getItemById:function(t){return f(this.el).children("."+this.options.listClass).find('[data-id="'+t+'"]')},_build:function(){var t=this.options.json;"string"==typeof t&&(t=JSON.parse(t)),f(this.el).html(this._buildList(t,this.options))},_buildList:function(t,s){if(!t)return"";var i="",o=this;return f.each(t,function(t,e){i+=o._buildItem(e,s)}),s.listRenderer(i,s)},_buildItem:function(t,e){var s=function(t){delete(t=f.extend({},t)).children,delete t.classes,delete t.content;var i={};return f.each(t,function(t,e){var s;"object"==typeof e&&(e=JSON.stringify(e)),i["data-"+t]=(s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},e+"".replace(/[&<>"']/g,function(t){return s[t]}))}),i}(t);s.class=function(t,e){var s=t.classes||{};"string"==typeof s&&(s=[s]);var i=function(t){var e={};for(var s in t)e[t[s]]=t[s];return e}(s);return i[e.itemClass]=e.itemClass,f.map(i,function(t){return t}).join(" ")}(t,e);var i=e.contentCallback(t),o=e.controlsCallback(t),l=this._buildList(t.children,e),n=f(e.itemRenderer(s,i,l,o,e,t));return this.setParent(n),n[0].outerHTML},serialize:function(){var l=this,n=function(t){var o=[];return t.children(l.options.itemNodeName).each(function(){var t=f(this),e=f.extend({content:t.text()},t.data()),s=t.children(l.options.listNodeName);if(l.options.includeContent){var i=t.find("."+l.options.contentClass).html();i&&(e.content=i)}s.length&&(e.children=n(s)),o.push(e)}),o};return n(l.el.find(l.options.listNodeName).first())},asNestedSet:function(){var a=this.options,r=[],t=1;return this.el.find(a.listNodeName).first().children(a.itemNodeName).each(function(){t=function t(e,s,i){var o,l,n=i+1;0<f(e).children(a.listNodeName).children(a.itemNodeName).length&&(s++,f(e).children(a.listNodeName).children(a.itemNodeName).each(function(){n=t(f(this),s,n)}),s--);o=f(e).attr("data-id");d(o)&&(o=parseInt(o));l=f(e).parent(a.listNodeName).parent(a.itemNodeName).attr("data-id")||"";d(l)&&(o=parseInt(l));o&&r.push({id:o,parent_id:l,depth:s,lft:i,rgt:n});i=n+1;return i}(this,0,t)}),r=r.sort(function(t,e){return t.lft-e.lft});function d(t){return f.isNumeric(t)&&Math.floor(t)==t}},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(t){var o=f.extend({},this.options,t),e=[];return f(this.element).children(o.items).each(function(){var t=function e(t){var s=(f(t).attr(o.attribute||"id")||"").match(o.expression||/(.+)[-=_](.+)/);if(s){var i={id:s[2]};return 0<f(t).children(o.listType).children(o.items).length&&(i.children=[],f(t).children(o.listType).children(o.items).each(function(){var t=e(this);i.children.push(t)})),i}}(this);e.push(t)}),e},toArray:function(){var r=f.extend({},this.options,this),d=r.startDepthCount||0,h=[],t=2;return this.el.find(this.options.listNodeName).first().children(this.options.itemNodeName).each(function(){t=function t(e,s,i){var o,l,n=i+1;0<e.children(r.options.listNodeName).children(r.options.itemNodeName).length&&(s++,e.children(r.options.listNodeName).children(r.options.itemNodeName).each(function(){n=t(f(this),s,n)}),s--);o=e.data().id;if(s===d+1)l=r.rootID;else{var a=e.parent(r.options.listNodeName).parent(r.options.itemNodeName).data();l=a.id}o&&h.push({id:o,parent_id:l,depth:s,left:i,right:n});i=n+1;return i}(f(this),d+1,t)}),h=h.sort(function(t,e){return t.left-e.left})},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options.listNodeName).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(f(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(f(this))})},setParent:function(t){t.is(this.options.itemNodeName)&&t.children(this.options.listNodeName).length&&(t.children("[data-action]").remove(),t.prepend(f(this.options.expandBtnHTML)),t.prepend(f(this.options.collapseBtnHTML)))},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,s=f(t.target).closest(this.options.itemNodeName),i={top:t.pageY,left:t.pageX},o=this.options.onDragStart.call(this,this.el,s,i);if(void 0===o||!1!==o){this.placeEl.css("height",s.height()),e.offsetX=t.pageX-s.offset().left,e.offsetY=t.pageY-s.offset().top,e.startX=e.lastX=t.pageX,e.startY=e.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=f(u.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",s.outerWidth()),this.setIndexOfItem(s),s.after(this.placeEl),s[0].parentNode.removeChild(s[0]),s.appendTo(this.dragEl),f(u.body).append(this.dragEl),this.dragEl.css({left:t.pageX-e.offsetX,top:t.pageY-e.offsetY});var l,n,a=this.dragEl.find(this.options.itemNodeName);for(l=0;l<a.length;l++)(n=f(a[l]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=n)}},createSubLevel:function(t,e){var s=f("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return e&&s.append(e),t.append(s),this.setParent(t),s},setIndexOfItem:function(t,e){(e=e||[]).unshift(t.index()),f(t[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(f(t[0].parentNode),e):this.dragEl.data("indexOfItem",e)},restoreItemAtIndex:function(t,e){var s,i,o=this.el,l=e.length-1;for(var n=0;n<e.length;n++){if(l===parseInt(n))return s=o,i=t,void(0===e[l]?f(s).prepend(i.clone(!0)):f(s.children[e[l]-1]).after(i.clone(!0)));var a=o[0]?o[0]:o,r=a.children[e[n]];o=r||this.createSubLevel(f(a))}},dragStop:function(t){var e={top:t.pageY,left:t.pageX},s=this.dragEl.data("indexOfItem"),i=this.dragEl.children(this.options.itemNodeName).first();i[0].parentNode.removeChild(i[0]),this.dragEl.remove();var o=this.options.beforeDragStop.call(this,this.el,i,this.placeEl.parent());if(void 0!==o&&!1===o){var l=this.placeEl.parent();return this.placeEl.remove(),l.children().length||this.unsetParent(l.parent()),this.el.find(".dd-empty").length&&this.el.find(".dd-empty").replaceWith(f(u.createElement(this.options.listNodeName)).addClass(this.options.listClass)),this.restoreItemAtIndex(i,s),void this.reset()}this.placeEl.replaceWith(i),this.hasNewRoot?(!0===this.options.fixed?this.restoreItemAtIndex(i,s):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,i,e),this.reset()},dragMove:function(t){var e,s,i,o=this.options,l=this.mouse;this.dragEl.css({left:t.pageX-l.offsetX,top:t.pageY-l.offsetY}),l.lastX=l.nowX,l.lastY=l.nowY,l.nowX=t.pageX,l.nowY=t.pageY,l.distX=l.nowX-l.lastX,l.distY=l.nowY-l.lastY,l.lastDirX=l.dirX,l.lastDirY=l.dirY,l.dirX=0===l.distX?0:0<l.distX?1:-1,l.dirY=0===l.distY?0:0<l.distY?1:-1;var n=Math.abs(l.distX)>Math.abs(l.distY)?1:0;if(!l.moving)return l.dirAx=n,void(l.moving=!0);if(o.scroll)if(void 0!==m.jQuery.fn.scrollParent){var a=!1,r=this.el.scrollParent()[0];r!==u&&"HTML"!==r.tagName?(o.scrollTriggers.bottom+r.offsetHeight-t.pageY<o.scrollSensitivity?r.scrollTop=a=r.scrollTop+o.scrollSpeed:t.pageY-o.scrollTriggers.top<o.scrollSensitivity&&(r.scrollTop=a=r.scrollTop-o.scrollSpeed),o.scrollTriggers.right+r.offsetWidth-t.pageX<o.scrollSensitivity?r.scrollLeft=a=r.scrollLeft+o.scrollSpeed:t.pageX-o.scrollTriggers.left<o.scrollSensitivity&&(r.scrollLeft=a=r.scrollLeft-o.scrollSpeed)):(t.pageY-f(u).scrollTop()<o.scrollSensitivity?a=f(u).scrollTop(f(u).scrollTop()-o.scrollSpeed):f(m).height()-(t.pageY-f(u).scrollTop())<o.scrollSensitivity&&(a=f(u).scrollTop(f(u).scrollTop()+o.scrollSpeed)),t.pageX-f(u).scrollLeft()<o.scrollSensitivity?a=f(u).scrollLeft(f(u).scrollLeft()-o.scrollSpeed):f(m).width()-(t.pageX-f(u).scrollLeft())<o.scrollSensitivity&&(a=f(u).scrollLeft(f(u).scrollLeft()+o.scrollSpeed)))}else console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information");this.scrollTimer&&clearTimeout(this.scrollTimer),o.scroll&&a&&(this.scrollTimer=setTimeout(function(){f(m).trigger(t)},10)),l.dirAx!==n?(l.distAxX=0,l.distAxY=0):(l.distAxX+=Math.abs(l.distX),0!==l.dirX&&l.dirX!==l.lastDirX&&(l.distAxX=0),l.distAxY+=Math.abs(l.distY),0!==l.dirY&&l.dirY!==l.lastDirY&&(l.distAxY=0)),l.dirAx=n,l.dirAx&&l.distAxX>=o.threshold&&(l.distAxX=0,i=this.placeEl.prev(o.itemNodeName),0<l.distX&&i.length&&!i.hasClass(o.collapsedClass)&&!i.hasClass(o.noChildrenClass)&&(e=i.find(o.listNodeName).last(),this.placeEl.parents(o.listNodeName).length+this.dragDepth<=o.maxDepth&&(e.length?(e=i.children(o.listNodeName).last()).append(this.placeEl):this.createSubLevel(i,this.placeEl))),l.distX<0&&(this.placeEl.next(o.itemNodeName).length||(s=this.placeEl.parent(),this.placeEl.closest(o.itemNodeName).after(this.placeEl),s.children().length||this.unsetParent(s.parent()))));var d=!1;if(g||(this.dragEl[0].style.visibility="hidden"),this.pointEl=f(u.elementFromPoint(t.pageX-u.body.scrollLeft,t.pageY-(m.pageYOffset||u.documentElement.scrollTop))),g||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(o.handleClass)&&(this.pointEl=this.pointEl.closest(o.itemNodeName)),this.pointEl.hasClass(o.emptyClass))d=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(o.itemClass))return;var h=this.pointEl.closest("."+o.rootClass),c=this.dragRootEl.data("nestable-id")!==h.data("nestable-id");if(!l.dirAx||c||d){if(c&&o.group!==h.data("nestable-group"))return;if(this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(o.listNodeName).length)return;if(this.dragDepth-1+this.pointEl.parents(o.listNodeName).length>o.maxDepth)return;var p=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;s=this.placeEl.parent(),d?((e=f(u.createElement(o.listNodeName)).addClass(o.listClass)).append(this.placeEl),this.pointEl.replaceWith(e)):p?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),s.children().length||this.unsetParent(s.parent()),this.dragRootEl.find(o.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=h,c&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}},appendEmptyElement:function(t){t.append('<div class="'+this.options.emptyClass+'"/>')}},f.fn.nestable=function(i){var o=this,l=arguments;return"Nestable"in m||(m.Nestable={},Nestable.counter=0),this.each(function(){var t=f(this).data("nestable");if(t){if("string"==typeof i&&"function"==typeof t[i])if(1<l.length){for(var e=[],s=1;s<l.length;s++)e.push(l[s]);o=t[i].apply(t,e)}else o=t[i]()}else Nestable.counter++,f(this).data("nestable",new a(this,i)),f(this).data("nestable-id",Nestable.counter)}),o||this}}(window.jQuery||window.Zepto,window,document);